<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;

        const MemoryTracker = () => {
            const [baseTier, setBaseTier] = useState(1);
            const [isNightmare, setIsNightmare] = useState(false);
            const [codexModifier, setCodexModifier] = useState(0);
            const [characters, setCharacters] = useState([
                { id: 1, name: 'Character 1', memory: 0, removals: 0, dupes: 0, history: [] },
                { id: 2, name: 'Character 2', memory: 0, removals: 0, dupes: 0, history: [] },
                { id: 3, name: 'Character 3', memory: 0, removals: 0, dupes: 0, history: [] }
            ]);

            const getTier = () => {
                let tier = baseTier;
                if (isNightmare) tier += 1;
                tier += codexModifier;
                return tier;
            };

            const getMaxMemory = () => {
                const tier = getTier();
                return 30 + 10 * (tier - 1);
            };

            const getRemovalCost = (count) => {
                if (count === 0) return 0;
                if (count === 1) return 10;
                if (count === 2) return 30;
                if (count === 3) return 50;
                return 70;
            };

            const getDupeCost = (count) => {
                if (count === 0) return 0;
                if (count === 1) return 10;
                if (count === 2) return 30;
                return 70;
            };

            const handleAction = (charId, baseAction) => {
                const char = characters.find(c => c.id === charId);
                let amount = 0;
                let action = '';
                let newRemovals = char.removals;
                let newDupes = char.dupes;

                switch(baseAction.type) {
                    case 'base':
                        amount = 0;
                        if (baseAction.epiphany) amount += 0;
                        if (baseAction.divineEpiphany) amount += 20;
                        action = `Base${baseAction.epiphany ? ' (E)' : ''}${baseAction.divineEpiphany ? ' (DE)' : ''}`;
                        break;
                    case 'neutral':
                        amount = 20;
                        if (baseAction.epiphany) amount += 10;
                        if (baseAction.divineEpiphany) amount += 20;
                        action = `Neutral${baseAction.epiphany ? ' (E)' : ''}${baseAction.divineEpiphany ? ' (DE)' : ''}`;
                        break;
                    case 'monster':
                        amount = 80;
                        if (baseAction.epiphany) amount += 10;
                        if (baseAction.divineEpiphany) amount += 20;
                        action = `Monster${baseAction.epiphany ? ' (E)' : ''}${baseAction.divineEpiphany ? ' (DE)' : ''}`;
                        break;
                    case 'removal':
                        amount = getRemovalCost(char.removals);
                        if (baseAction.specialCard) amount += 20;
                        action = `Removal #${char.removals + 1}${baseAction.specialCard ? ' (Char)' : ''}`;
                        newRemovals = char.removals + 1;
                        break;
                    case 'dupe':
                        amount = getDupeCost(char.dupes);
                        action = `Dupe #${char.dupes + 1}`;
                        newDupes = char.dupes + 1;
                        break;
                    case 'convert':
                        amount = 10;
                        action = 'Convert';
                        break;
                    case 'forbidden':
                        amount = 20;
                        action = 'Forbidden';
                        break;
                }

                setCharacters(chars => chars.map(c => {
                    if (c.id === charId) {
                        return {
                            ...c,
                            memory: c.memory + amount,
                            removals: newRemovals,
                            dupes: newDupes,
                            history: [...c.history, { action, amount }]
                        };
                    }
                    return c;
                }));
            };

            const undo = (charId) => {
                setCharacters(chars => chars.map(char => {
                    if (char.id === charId && char.history.length > 0) {
                        const newHistory = [...char.history];
                        const lastAction = newHistory.pop();
                        
                        let newRemovals = char.removals;
                        let newDupes = char.dupes;
                        
                        if (lastAction.action.includes('Removal')) newRemovals = Math.max(0, char.removals - 1);
                        if (lastAction.action.includes('Dupe')) newDupes = Math.max(0, char.dupes - 1);
                        
                        return {
                            ...char,
                            memory: char.memory - lastAction.amount,
                            removals: newRemovals,
                            dupes: newDupes,
                            history: newHistory
                        };
                    }
                    return char;
                }));
            };

            const reset = (charId) => {
                if (charId === 'all') {
                    setCharacters(chars => chars.map(char => ({
                        ...char,
                        memory: 0,
                        removals: 0,
                        dupes: 0,
                        history: []
                    })));
                } else {
                    setCharacters(chars => chars.map(char => {
                        if (char.id === charId) {
                            return { ...char, memory: 0, removals: 0, dupes: 0, history: [] };
                        }
                        return char;
                    }));
                }
            };

            const updateCharacterName = (charId, newName) => {
                setCharacters(chars => chars.map(c => 
                    c.id === charId ? { ...c, name: newName } : c
                ));
            };

            const ActionButton = ({ charId, type, label, color }) => {
                const [showModifiers, setShowModifiers] = useState(false);
                const [modifierType, setModifierType] = useState('none');
                const [specialCard, setSpecialCard] = useState(false);

                const handleClick = () => {
                    if (type === 'base' || type === 'neutral' || type === 'monster') {
                        setShowModifiers(!showModifiers);
                    } else if (type === 'removal') {
                        setShowModifiers(!showModifiers);
                    } else {
                        handleAction(charId, { type });
                    }
                };

                const handleConfirm = () => {
                    const epiphany = modifierType === 'epiphany';
                    const divineEpiphany = modifierType === 'divine';
                    handleAction(charId, { type, epiphany, divineEpiphany, specialCard });
                    setShowModifiers(false);
                    setModifierType('none');
                    setSpecialCard(false);
                };

                const char = characters.find(c => c.id === charId);

                return (
                    <div className="relative">
                        <button
                            onClick={handleClick}
                            className={`w-full px-3 py-2 rounded font-medium text-sm transition ${color}`}
                        >
                            {label}
                        </button>
                        
                        {showModifiers && (
                            <div className="absolute z-10 mt-1 w-full bg-gray-800 border border-gray-600 rounded-lg p-3 shadow-lg">
                                {type === 'base' && (
                                    <div className="mb-3">
                                        <div className="text-xs text-gray-400 mb-2">Card Type:</div>
                                        <div className="space-y-1.5">
                                            <label className="flex items-center gap-2 text-sm">
                                                <input
                                                    type="radio"
                                                    name={`modifier-${charId}-${type}`}
                                                    value="none"
                                                    checked={modifierType === 'none'}
                                                    onChange={() => setModifierType('none')}
                                                    className="w-4 h-4"
                                                />
                                                <span>Normal <span className="text-gray-400">(0 pts)</span></span>
                                            </label>
                                            <label className="flex items-center gap-2 text-sm">
                                                <input
                                                    type="radio"
                                                    name={`modifier-${charId}-${type}`}
                                                    value="epiphany"
                                                    checked={modifierType === 'epiphany'}
                                                    onChange={() => setModifierType('epiphany')}
                                                    className="w-4 h-4"
                                                />
                                                <span>Epiphany <span className="text-gray-400">(+0)</span></span>
                                            </label>
                                            <label className="flex items-center gap-2 text-sm">
                                                <input
                                                    type="radio"
                                                    name={`modifier-${charId}-${type}`}
                                                    value="divine"
                                                    checked={modifierType === 'divine'}
                                                    onChange={() => setModifierType('divine')}
                                                    className="w-4 h-4"
                                                />
                                                <span>Divine Epiphany <span className="text-purple-400">(+20)</span></span>
                                            </label>
                                        </div>
                                    </div>
                                )}
                                {(type === 'neutral' || type === 'monster') && (
                                    <div className="mb-3">
                                        <div className="text-xs text-gray-400 mb-2">Card Type:</div>
                                        <div className="space-y-1.5">
                                            <label className="flex items-center gap-2 text-sm">
                                                <input
                                                    type="radio"
                                                    name={`modifier-${charId}-${type}`}
                                                    value="none"
                                                    checked={modifierType === 'none'}
                                                    onChange={() => setModifierType('none')}
                                                    className="w-4 h-4"
                                                />
                                                <span>Normal</span>
                                            </label>
                                            <label className="flex items-center gap-2 text-sm">
                                                <input
                                                    type="radio"
                                                    name={`modifier-${charId}-${type}`}
                                                    value="epiphany"
                                                    checked={modifierType === 'epiphany'}
                                                    onChange={() => setModifierType('epiphany')}
                                                    className="w-4 h-4"
                                                />
                                                <span>Epiphany <span className="text-green-400">(+10)</span></span>
                                            </label>
                                            <label className="flex items-center gap-2 text-sm">
                                                <input
                                                    type="radio"
                                                    name={`modifier-${charId}-${type}`}
                                                    value="divine"
                                                    checked={modifierType === 'divine'}
                                                    onChange={() => setModifierType('divine')}
                                                    className="w-4 h-4"
                                                />
                                                <span>Divine Epiphany <span className="text-purple-400">(+20)</span></span>
                                            </label>
                                        </div>
                                    </div>
                                )}
                                {type === 'removal' && (
                                    <label className="flex items-center gap-2 text-sm mb-3">
                                        <input
                                            type="checkbox"
                                            checked={specialCard}
                                            onChange={(e) => setSpecialCard(e.target.checked)}
                                            className="w-4 h-4"
                                        />
                                        <span>Character Card <span className="text-yellow-400">(Starting/Epiphany +20)</span></span>
                                    </label>
                                )}
                                <button
                                    onClick={handleConfirm}
                                    className="w-full bg-blue-600 hover:bg-blue-700 px-3 py-1.5 rounded text-sm font-medium"
                                >
                                    Confirm
                                </button>
                            </div>
                        )}
                    </div>
                );
            };

            const CharacterCard = ({ char }) => {
                const maxMem = getMaxMemory();
                const percentage = (char.memory / maxMem) * 100;
                const status = percentage >= 100 ? 'over' : percentage >= 80 ? 'near' : 'good';
                
                const statusColors = {
                    good: 'text-green-400',
                    near: 'text-yellow-400',
                    over: 'text-red-400'
                };

                return (
                    <div className="bg-gray-800 rounded-lg p-4 border-2 border-gray-700">
                        <div className="mb-4">
                            <input
                                type="text"
                                value={char.name}
                                onChange={(e) => updateCharacterName(char.id, e.target.value)}
                                className="text-xl font-bold bg-transparent border-b border-gray-600 focus:border-blue-500 outline-none w-full pb-1"
                            />
                            <div className={`text-4xl font-bold mt-2 ${statusColors[status]}`}>
                                {char.memory} / {maxMem}
                            </div>
                            <div className="flex gap-2 mt-2 text-sm text-gray-400">
                                <span className="bg-gray-700 px-2 py-1 rounded">Removals: {char.removals}</span>
                                <span className="bg-gray-700 px-2 py-1 rounded">Dupes: {char.dupes}</span>
                            </div>
                        </div>

                        <div className="space-y-2 mb-4">
                            <ActionButton 
                                charId={char.id} 
                                type="base" 
                                label="Base Card" 
                                color="bg-gray-600 hover:bg-gray-700"
                            />
                            <ActionButton 
                                charId={char.id} 
                                type="neutral" 
                                label="Neutral Card" 
                                color="bg-blue-600 hover:bg-blue-700"
                            />
                            <ActionButton 
                                charId={char.id} 
                                type="monster" 
                                label="Monster Card" 
                                color="bg-purple-600 hover:bg-purple-700"
                            />
                            <ActionButton 
                                charId={char.id} 
                                type="removal" 
                                label={`Remove Card (${getRemovalCost(char.removals)} pts)`}
                                color="bg-orange-600 hover:bg-orange-700"
                            />
                            <ActionButton 
                                charId={char.id} 
                                type="dupe" 
                                label={`Dupe Card (${getDupeCost(char.dupes)} pts)`}
                                color="bg-pink-600 hover:bg-pink-700"
                            />
                            <ActionButton 
                                charId={char.id} 
                                type="convert" 
                                label="Convert (+10)" 
                                color="bg-teal-600 hover:bg-teal-700"
                            />
                            <ActionButton 
                                charId={char.id} 
                                type="forbidden" 
                                label="Forbidden (+20)" 
                                color="bg-red-600 hover:bg-red-700"
                            />
                        </div>

                        <div className="flex gap-2">
                            <button
                                onClick={() => undo(char.id)}
                                disabled={char.history.length === 0}
                                className="flex-1 flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 px-3 py-2 rounded text-sm font-medium transition"
                            >
                                ↶ Undo
                            </button>
                            <button
                                onClick={() => reset(char.id)}
                                className="flex-1 flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded text-sm font-medium transition"
                            >
                                ↻ Reset
                            </button>
                        </div>

                        {char.history.length > 0 && (
                            <div className="mt-4 pt-4 border-t border-gray-700">
                                <div className="text-xs text-gray-400 mb-2">Recent Actions:</div>
                                <div className="space-y-1 max-h-32 overflow-y-auto">
                                    {char.history.slice(-5).reverse().map((h, i) => (
                                        <div key={i} className="text-xs flex justify-between bg-gray-900 px-2 py-1 rounded">
                                            <span>{h.action}</span>
                                            <span className="text-green-400">+{h.amount}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-900 text-white p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="mb-6">
                            <h1 className="text-3xl font-bold mb-4">Memory Tracker</h1>
                            
                            <div className="bg-gray-800 border border-gray-700 rounded-lg p-4 mb-4">
                                <div className="flex flex-wrap items-center gap-6">
                                    <div>
                                        <label className="flex items-center gap-2">
                                            <span className="text-gray-400">Difficulty Tier:</span>
                                            <select
                                                value={baseTier}
                                                onChange={(e) => setBaseTier(Number(e.target.value))}
                                                className="bg-gray-900 border border-gray-600 rounded px-3 py-1.5 font-bold text-white"
                                            >
                                                {[...Array(12)].map((_, i) => (
                                                    <option key={i + 1} value={i + 1}>
                                                        Tier {i + 1}
                                                    </option>
                                                ))}
                                            </select>
                                        </label>
                                    </div>

                                    <div>
                                        <label className="flex items-center gap-2">
                                            <input
                                                type="checkbox"
                                                checked={isNightmare}
                                                onChange={(e) => setIsNightmare(e.target.checked)}
                                                className="w-4 h-4"
                                            />
                                            <span className="text-gray-400">Nightmare Mode <span className="text-purple-400">(+1 Tier)</span></span>
                                        </label>
                                    </div>

                                    <div>
                                        <label className="flex items-center gap-2">
                                            <span className="text-gray-400">Codex Modifier:</span>
                                            <select
                                                value={codexModifier}
                                                onChange={(e) => setCodexModifier(Number(e.target.value))}
                                                className="bg-gray-900 border border-gray-600 rounded px-3 py-1.5 font-bold text-white"
                                            >
                                                <option value={0}>None</option>
                                                <option value={1}>+1 Tier</option>
                                                <option value={2}>+2 Tier</option>
                                            </select>
                                        </label>
                                    </div>

                                    <div className="ml-auto flex items-center gap-4">
                                        <div className="text-right">
                                            <div className="text-sm text-gray-400">Effective Tier</div>
                                            <div className="text-2xl font-bold text-blue-400">{getTier()}</div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-sm text-gray-400">Memory Cap</div>
                                            <div className="text-2xl font-bold text-green-400">{getMaxMemory()}</div>
                                        </div>
                                        <button
                                            onClick={() => reset('all')}
                                            className="flex items-center gap-2 bg-red-600 hover:bg-red-700 px-4 py-2 rounded font-medium transition"
                                        >
                                            ↻ Reset All
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-3 gap-6">
                            {characters.map(char => (
                                <CharacterCard key={char.id} char={char} />
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MemoryTracker />);
    </script>
</body>
</html>